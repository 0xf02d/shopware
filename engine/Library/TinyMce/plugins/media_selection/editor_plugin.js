!function(){tinymce.create("tinymce.plugins.MediaSelectionPlugin",{ed:null,imageCls:"tinymce-editor-image",linkCls:"tinymce-editor-link",videoCls:"tinymce-editor-video",audioCls:"tinymce-editor-audio",init:function(e,t){var i=this;i.ed=e,e.addCommand("mceMediaSelection",function(){var n=!1;"function"!=typeof Shopware.app.Application.addSubApplication&&Ext.Error.raise({msg:"Your ExtJS application does not support sub applications",option:[e,t]}),i.ed.settings&&i.ed.settings.fullscreen_is_enabled&&(n=!0),Shopware.app.Application.addSubApplication({name:"Shopware.apps.MediaManager",layout:"small",forceToFront:n,selectionMode:"single",eventScope:i,mediaSelectionCallback:i._processImage})}),e.addButton("media_selection",{title:"Media Selection",cls:"tinymce-media-selection",cmd:"mceMediaSelection",image:t+"/icons/inbox-image.png"})},getInfo:function(){return{longname:"MediaManager - MediaSelection",author:"shopware AG - st.pohl",authorurl:"http://www.shopware.de",infourl:"http://wiki.shopware.de/",version:"1.0.0"}},_processImage:function(e){var t,i,n=this,a=n.ed,o=e.up("window"),s=o.down(".mediamanager-media-view");s="grid"===s.selectedLayout?s.dataView:s.cardContainer.getLayout().getActiveItem(),t=s.getSelectionModel(),i=t.getSelection(),Ext.each(i,function(e){var t=e.get("type");"VIDEO"===t?n._insertVideo(e):"IMAGE"===t?n._insertImage(e):"MUSIC"===t?n._insertAudio(e):n._insertLink(e),a.undoManager.add()}),o.destroy()},_insertImage:function(e){var t,i=this,n=i.ed;return t={"class":i.imageCls,width:e.get("width"),height:e.get("height"),alt:e.get("name"),src:e.get("virtualPath")},n.execCommand("mceInsertContent",!1,tinymce.DOM.createHTML("img",t),{skip_undo:1}),!0},_insertLink:function(e){var t,i=this,n=i.ed;return t={"class":i.linkCls,href:e.get("path"),title:e.get("name"),target:"_blank"},n.execCommand("mceInsertContent",!1,tinymce.DOM.createHTML("a",t,e.get("name")),{skip_undo:1}),!0},_insertVideo:function(e){var t,i=this,n=i.ed;return t={"class":i.videoCls,width:320,height:240,src:n.settings.document_base_url+e.get("path"),controls:!0},n.execCommand("mceInsertContent",!1,tinymce.DOM.createHTML("video",t),{skip_undo:1}),!0},_insertAudio:function(e){var t,i=this,n=i.ed;return t={"class":i.audioCls,src:n.settings.document_base_url+e.get("path"),controls:!0},n.execCommand("mceInsertContent",!1,tinymce.DOM.createHTML("audio",t),{skip_undo:1}),!0}}),tinymce.PluginManager.add("media_selection",tinymce.plugins.MediaSelectionPlugin)}();